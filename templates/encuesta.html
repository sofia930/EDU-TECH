<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Encuesta de Estilo de Aprendizaje</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>

    <h2>Encuesta de Estilo de Aprendizaje</h2>

    <form id="encuestaForm" method="POST" onsubmit="return validarEncuesta()">
        {% for pregunta in preguntas %}
            <p> {{ pregunta.texto }}</p>

            <label>
                <input type="radio" name="pregunta{{ loop.index + (pagina - 1) * 20 }}" value="+" 
                {% if respuestas_previas and respuestas_previas.get(pregunta.texto, '') == '+' %} checked {% endif %}> Sí
            </label>

            <label>
                <input type="radio" name="pregunta{{ loop.index + (pagina - 1) * 20 }}" value="-"
                {% if respuestas_previas and respuestas_previas.get(pregunta.texto, '') == '-' %} checked {% endif %}> No
            </label>

            <br><br>
        {% endfor %}

        <p id="errorMensaje" style="color: red; display: none;">⚠️ Debes responder todas las preguntas antes de continuar.</p>

        <div class="botones">
            {% if pagina > 1 %}
                <a href="{{ url_for('encuesta', pagina=pagina-1) }}">
                    <button type="button">Atrás</button>
                </a>
            {% endif %}

            {% if pagina < total_paginas %}
                <button type="submit">Siguiente</button>
            {% else %}
                <button type="submit">Finalizar Encuesta</button>
            {% endif %}
        </div>
    </form>

    <script>
    function validarEncuesta() {
        const preguntas = document.querySelectorAll("input[type='radio']");
        const grupos = new Set();
        let todasRespondidas = true;

        preguntas.forEach(pregunta => {
            grupos.add(pregunta.name);
        });

        grupos.forEach(grupo => {
            const opciones = document.querySelectorAll(`input[name="${grupo}"]:checked`);
            if (opciones.length === 0) {
                todasRespondidas = false;
            }
        });

        if (!todasRespondidas) {
            document.getElementById("errorMensaje").style.display = "block";
            return false;  // Evita el envío del formulario
        }

        return true;  // Permite el envío si todas están respondidas
    }
    </script>
 
 <script>
    document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("encuestaForm");

        form.addEventListener("submit", function (event) {
            const preguntas = document.querySelectorAll("input[type='radio']");
            const respuestas = {};
            let completadas = true;

            preguntas.forEach((pregunta) => {
                const name = pregunta.name;
                if (!respuestas[name]) {
                    respuestas[name] = false;
                }
                if (pregunta.checked) {
                    respuestas[name] = true;
                }
            });

            // Verifica si todas las preguntas de la página actual fueron respondidas
            for (const pregunta in respuestas) {
                if (!respuestas[pregunta]) {
                    completadas = false;
                    break;
                }
            }

            if (!completadas) {
                event.preventDefault();
                alert("Debes responder todas las preguntas antes de continuar.");
            }
        });
    });
</script>

</body>
</html>