<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Encuesta de Estilo de Aprendizaje</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>

    <h2>Encuesta de Estilo de Aprendizaje</h2>

    <form id="encuestaForm" method="POST" action="{{ url_for('guardar_respuestas') }}">
        {% for pregunta in preguntas %}
            <p>{{ pregunta.texto }}</p>
            
            <label>
                <input type="radio" name="pregunta{{ loop.index0 }}" value="+" 
                {% if respuestas_previas.get(pregunta.texto, '') == '+' %} checked {% endif %}>
                Sí
            </label>

            <label>
                <input type="radio" name="pregunta{{ loop.index0 }}" value="-"
                {% if respuestas_previas.get(pregunta.texto, '') == '-' %} checked {% endif %}>
                No
            </label>
            
            <br><br>
        {% endfor %}

        <!-- Botón para guardar el avance -->
        <button type="submit">Guardar y Salir</button>

        <!-- Botón de ver resultados (deshabilitado hasta que se responda todo) -->
        <button id="verResultados" type="button" disabled onclick="enviarResultados()">Ver Resultados</button>
    </form>

    <script>
    document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("encuestaForm");
        const botonResultados = document.getElementById("verResultados");

        // Obtener el número total de preguntas desde Jinja
        const totalPreguntas = Number("{{ preguntas|length }}");

        function verificarRespuestasCompletas() {
            const respuestas = document.querySelectorAll("input[type='radio']:checked");
            botonResultados.disabled = respuestas.length !== totalPreguntas;
        }

        // Escuchar cambios en las respuestas
        document.querySelectorAll("input[type='radio']").forEach(radio => {
            radio.addEventListener("change", verificarRespuestasCompletas);
        });

        // Verificar al cargar si ya hay respuestas previas
        verificarRespuestasCompletas();
    });

    function enviarResultados() {
        document.getElementById("encuestaForm").action = "{{ url_for('resultado') }}";
        document.getElementById("encuestaForm").submit();
    }
    </script>

</body>
</html>